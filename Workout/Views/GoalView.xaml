<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Workout.ViewModels"
             x:Class="Workout.Views.GoalView"
             x:Name="GoalsPage"
             BackgroundColor="{DynamicResource BackgroundColor}">

    <ContentPage.BindingContext>
        <vm:GoalViewModel />
    </ContentPage.BindingContext>

    <Grid>

        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="15">

                <Label Text="The Goals of Excesss"
                       FontSize="28"
                       TextColor="{DynamicResource PrimaryTextColor}"
                       HorizontalOptions="Center"/>

                <!-- Goal type picker -->
                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60">
                    <Picker Title="Select Goal Type"
                            ItemsSource="{Binding GoalTypes}"
                            SelectedItem="{Binding SelectedGoalType, Mode=TwoWay}"
                            TextColor="{DynamicResource EntryTextColor}"
                            BackgroundColor="Transparent"
                            FontSize="20"
                            VerticalOptions="Center"/>
                </Frame>

                <!-- Conditional inputs -->
                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowCaloriesInput}">
                    <Entry Placeholder="Target Calories"
                           Keyboard="Numeric"
                           Text="{Binding TargetCalories}"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                </Frame>

                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowExerciseInput}">
                    <Entry Placeholder="Target Exercise Minutes"
                           Keyboard="Numeric"
                           Text="{Binding TargetExerciseMinutes}"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                </Frame>

                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowMuscleInput}">
                    <Entry Placeholder="Target Muscle Weight"
                           Keyboard="Numeric"
                           Text="{Binding TargetMuscleWeight}"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                </Frame>

                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowMuscleInput}">
                    <Entry Placeholder="Target Muscle Appearance"
                           Text="{Binding TargetMuscleAppearance}"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                </Frame>

                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowWeightInput}">
                    <Entry Placeholder="Target Weight"
                           Keyboard="Numeric"
                           Text="{Binding TargetWeight}"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                </Frame>

                <!-- New DatePicker -->
                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowTargetDate}">
                    <DatePicker Date="{Binding TargetDate}"
                                TextColor="{DynamicResource EntryTextColor}"
                                BackgroundColor="Transparent"
                                FontSize="20"
                                VerticalOptions="Center"/>
                </Frame>

                <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}"
                       BorderColor="{DynamicResource EntryBorderColor}"
                       CornerRadius="8"
                       Padding="0"
                       HeightRequest="60"
                       IsVisible="{Binding ShowNotesInput}">
                    <Entry Placeholder="Notes"
                           Text="{Binding Notes}"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                </Frame>

                <Button Text="Save Goal"
                        BackgroundColor="{DynamicResource ButtonBackgroundColor}"
                        TextColor="{DynamicResource ButtonTextColor}"
                        FontSize="22"
                        HeightRequest="60"
                        Command="{Binding SaveCommand}"
                        IsVisible="{Binding IsGoalTypeSelected}"/>

                <!-- Saved goals -->
                <CollectionView ItemsSource="{Binding Goals}" Margin="0,20,0,0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <SwipeView>
                                <SwipeView.LeftItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem Text="Edit"
                                                   BackgroundColor="{DynamicResource ButtonBackgroundColor}"
                                                   Command="{Binding BindingContext.EditCommand, Source={x:Reference GoalsPage}}"
                                                   CommandParameter="{Binding}" />
                                    </SwipeItems>
                                </SwipeView.LeftItems>

                                <SwipeView.RightItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem Text="Delete"
                                                   BackgroundColor="{DynamicResource DeleteButtonColor}"
                                                   Command="{Binding BindingContext.DeleteCommand, Source={x:Reference GoalsPage}}"
                                                   CommandParameter="{Binding}" />
                                    </SwipeItems>
                                </SwipeView.RightItems>

                                <Frame BackgroundColor="{DynamicResource CollectionItemBackgroundColor}" 
                                       CornerRadius="10" 
                                       Padding="10" 
                                       Margin="0,5">
                                    <VerticalStackLayout Spacing="5">
                                        <Label Text="{Binding GoalType}" TextColor="{DynamicResource CollectionItemPrimaryTextColor}" FontSize="18"/>
                                        <Label Text="{Binding TargetDate, StringFormat='Target Date: {0:d}'}" TextColor="{DynamicResource CollectionItemTextColor}"/>
                                        <Label Text="{Binding ProgressText}" TextColor="{DynamicResource CollectionItemTextColor}"/>
                                        <ProgressBar Progress="{Binding Progress}"
                                                     BackgroundColor="{DynamicResource EntryBackgroundColor}"
                                                     ProgressColor="{DynamicResource ButtonBackgroundColor}"
                                                     HeightRequest="10"/>
                                        <Label Text="{Binding Notes}" TextColor="{DynamicResource CollectionItemTextColor}"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </SwipeView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Edit modal overlay -->
        <Grid BackgroundColor="{DynamicResource ModalOverlayColor}"
      IsVisible="{Binding IsEditModalVisible}"
      VerticalOptions="Center"
      HorizontalOptions="Center">

            <Frame BackgroundColor="{DynamicResource BackgroundColor}"
           BorderColor="{DynamicResource EntryBorderColor}"
           CornerRadius="20"
           Padding="20"
           HasShadow="True"
           WidthRequest="350"
           HeightRequest="450"
           VerticalOptions="Center"
           HorizontalOptions="Center">

                <ScrollView>
                    <VerticalStackLayout Spacing="15">

                        <Label Text="Edit Goal"
                       TextColor="{DynamicResource PrimaryTextColor}"
                       FontSize="28"
                       HorizontalOptions="Center"/>

                        <!-- Goal Type Display (cannot be changed) -->
                        <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}" 
                       BorderColor="{DynamicResource EntryBorderColor}" 
                       CornerRadius="8" Padding="0" HeightRequest="60">
                            <Label Text="{Binding EditGoalType}"
                           TextColor="{DynamicResource EntryTextColor}"
                           FontSize="20"
                           VerticalOptions="Center"
                           HorizontalOptions="Start"
                           Padding="10,0"/>
                        </Frame>

                        <!-- Calories Input (only visible for calorie goal) -->
                        <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}" 
                       BorderColor="{DynamicResource EntryBorderColor}" 
                       CornerRadius="8" Padding="0" HeightRequest="60"
                       IsVisible="{Binding EditShowCaloriesInput}">
                            <Entry Placeholder="Target Calories"
                           Text="{Binding EditTargetCalories, Mode=TwoWay}"
                           Keyboard="Numeric"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                        </Frame>

                        <!-- Exercise Minutes Input (only visible for exercise goal) -->
                        <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}" 
                       BorderColor="{DynamicResource EntryBorderColor}" 
                       CornerRadius="8" Padding="0" HeightRequest="60"
                       IsVisible="{Binding EditShowExerciseInput}">
                            <Entry Placeholder="Target Exercise Minutes"
                           Text="{Binding EditTargetExerciseMinutes, Mode=TwoWay}"
                           Keyboard="Numeric"
                           TextColor="{DynamicResource EntryTextColor}"
                           BackgroundColor="Transparent"
                           FontSize="20"
                           VerticalOptions="Center"/>
                        </Frame>

                        <!-- Date Picker -->
                        <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}" 
                       BorderColor="{DynamicResource EntryBorderColor}" 
                       CornerRadius="8" Padding="0" HeightRequest="60">
                            <DatePicker Date="{Binding EditTargetDate, Mode=TwoWay}" 
                                TextColor="{DynamicResource EntryTextColor}" 
                                FontSize="20"
                                VerticalOptions="Center"/>
                        </Frame>

                        <!-- Notes Editor -->
                        <Frame BackgroundColor="{DynamicResource EntryBackgroundColor}" 
                       BorderColor="{DynamicResource EntryBorderColor}" 
                       CornerRadius="8" Padding="0">
                            <Editor Placeholder="Notes"
                            Text="{Binding EditNotes, Mode=TwoWay}"
                            TextColor="{DynamicResource EntryTextColor}"
                            BackgroundColor="{DynamicResource EntryBackgroundColor}"
                            FontSize="20"
                            AutoSize="TextChanges"
                            HeightRequest="100"/>
                        </Frame>

                        <!-- Buttons -->
                        <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Button Text="Save Changes" Command="{Binding SaveEditCommand}"
                            BackgroundColor="{DynamicResource ButtonBackgroundColor}"
                            TextColor="{DynamicResource ButtonTextColor}"/>
                            <Button Text="Cancel" Command="{Binding CancelEditCommand}"
                            BackgroundColor="{DynamicResource EntryBackgroundColor}"
                            TextColor="{DynamicResource EntryTextColor}"
                            BorderColor="{DynamicResource EntryBorderColor}"
                            BorderWidth="1"/>
                        </HorizontalStackLayout>

                    </VerticalStackLayout>
                </ScrollView>

            </Frame>
        </Grid>

<!--always need more screaming so AAAAAAAAAAAAAAAAHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH-->



    </Grid>
</ContentPage>
